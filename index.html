<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="stylesheet" type="text/css" href="./lib/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <title>Blog</title>
  </head>

  <body>
    <div class="container my-5">
      <a href="../index.html" id="logo">Your Blog Name</a>
      <div class="row px-2">
        <div class="col-md-6 mx-auto">
          <div id="post-list"></div>
        </div>
      </div>
      <div class="row justify-content-center mb-4">
        <div id="page-directory"></div>
      </div>

      <div id="footer">Copyright 2023</div>
    </div>
  </body>

  <script src="./lib/jquery.min.js"></script>

  <script type="module">
    // DEFINE POSTS-PER-PAGE
    const postsPerPage = 10; // TODO: define this in a json config file

    // Load the post metadata from the JSON file
    fetch('generated/posts.json')
      .then((response) => response.json())
      // posts manifest looks like this: {"sample2.md": {"title": "<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css\">", "created": "Fri Jun  9 10:04:01 2023", "modified": "Fri Jun  9 10:04:01 2023"}, "sample.md": {"title": "this is a test", "created": "Fri Jun  9 10:04:01 2023", "modified": "Fri Jun  9 10:04:01 2023"}, "sample3.md": {"title": "h1", "created": "Fri Jun  9 10:04:01 2023", "modified": "Fri Jun  9 10:04:01 2023"}, "this-is-a-test.md": {"title": "this was added using github", "created": "Fri Jun  9 08:35:35 2023", "modified": "Fri Jun  9 08:35:35 2023"}, "this-is-a-test copy.md": {"title": "this was added In VS Code!", "created": "Fri Jun  9 09:13:45 2023", "modified": "Fri Jun  9 09:13:45 2023"}}
      .then((posts) => {
        // Sort the posts in reverse chronological order by modified time
        const sortedPosts = Object.entries(posts).sort(
          (a, b) => new Date(b[1].modified) - new Date(a[1].modified),
        );

        // DO NOT TOUCH BELOW
        $(document).ready(function () {
          setPosts(1);
          setPageDirectory(1);
        });

        function setPosts(pageNumber) {
          var postListHTML = '';
          var count = 0;
          const truncateModifiedDate = (date) =>
            date.toString().split(' ').slice(0, 4).join(' ');
          const minPostIndex = postsPerPage * (pageNumber - 1);
          const maxPostIndex = minPostIndex + postsPerPage - 1;
          for (
            let i = minPostIndex;
            i <= maxPostIndex && i < sortedPosts.length;
            i++
          ) {
            const [filename, metadata] = sortedPosts[i];
            postListHTML += `
                        <a class='post-link lead' href="generated/posts/${filename.replace(
                          '.md',
                          '.html',
                        )}">
                            ${metadata['title']}
                        </a>
                        <div class="post-subtitle">
                            ${truncateModifiedDate(metadata['modified'])}
                        </div>
                    `;
          }
          document.getElementById('post-list').innerHTML = postListHTML;
        }

        function setPageDirectory(currentPage) {
          let numPosts = sortedPosts.length;
          let numPages = Math.ceil(numPosts / postsPerPage);

          if (numPages > 1) {
            var pagesHTML = '';
            for (let i = 1; i <= numPages; i++) {
              var pageText = '';
              if (i == currentPage) {
                pageText = `<b>${i}</b>`;
              } else {
                pageText = `${i}`;
              }
              pagesHTML += `
                            <a class="page-number mx-1" id="${i}" href="#">${pageText}</a>
                        `;
            }
            document.getElementById('page-directory').innerHTML = pagesHTML;
          }
          updatePostsOnPageNumClick();
        }

        function updatePostsOnPageNumClick() {
          $('.page-number').on('click', function () {
            let pageNumber = parseInt($(this).attr('id'));
            setPosts(pageNumber);
            setPageDirectory(pageNumber);
          });
        }
      });
  </script>
</html>
